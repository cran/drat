<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>Basics</title>

<script type="text/javascript">
window.onload = function() {
  var imgs = document.getElementsByTagName('img'), i, img;
  for (i = 0; i < imgs.length; i++) {
    img = imgs[i];
    // center an image if it is the only element of its parent
    if (img.parentElement.childElementCount === 1)
      img.parentElement.style.textAlign = 'center';
  }
};
</script>





<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 13px;
}

body {
  max-width: 800px;
  margin: auto;
  padding: 1em;
  line-height: 20px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 {
   font-size:2.2em;
}

h2 {
   font-size:1.8em;
}

h3 {
   font-size:1.4em;
}

h4 {
   font-size:1.0em;
}

h5 {
   font-size:0.9em;
}

h6 {
   font-size:0.8em;
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre, img {
  max-width: 100%;
}
pre {
  overflow-x: auto;
}
pre code {
   display: block; padding: 0.5em;
}

code {
  font-size: 92%;
  border: 1px solid #ccc;
}

code[class] {
  background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * {
      background: transparent !important;
      color: black !important;
      filter:none !important;
      -ms-filter: none !important;
   }

   body {
      font-size:12pt;
      max-width:100%;
   }

   a, a:visited {
      text-decoration: underline;
   }

   hr {
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote {
      padding-right: 1em;
      page-break-inside: avoid;
   }

   tr, img {
      page-break-inside: avoid;
   }

   img {
      max-width: 100% !important;
   }

   @page :left {
      margin: 15mm 20mm 15mm 10mm;
   }

   @page :right {
      margin: 15mm 10mm 15mm 20mm;
   }

   p, h2, h3 {
      orphans: 3; widows: 3;
   }

   h2, h3 {
      page-break-after: avoid;
   }
}
</style>



</head>

<body>
<blockquote>
<p>Note: This is work in progress started with Colin initial README in the dratTravis repo. 
To be expanded and as of yet incomplete</p>
</blockquote>

<h2>Basics</h2>

<ul>
<li><a href="https://github.com/eddelbuettel/drat">Drat</a> is a useful little package, for, <em>inter-alia</em>, using
github <em>gh-pages</em> as an R repository</li>
<li><a href="https://github.com/craigcitro/r-travis">Travis</a> is a hosted continuous integration service. 
It is integrated with gitHub and offers first class support for a number of languages, but importantly, R.</li>
</ul>

<p>The <a href="https://github.com/csgillespie/dratTravis">dratTravis</a> package illustrates how to automatically update a <code>drat</code> github repository, on a <em>successful</em> travis build.</p>

<h2>Getting Started</h2>

<ol>
<li><p>Set up a <a href="https://github.com/eddelbuettel/drat">drat</a> repo</p></li>
<li><p>Add <a href="https://github.com/craigcitro/r-travis">travis</a> support to your package</p></li>
<li><p>Get a github <a href="https://github.com/settings/tokens/new">API token</a> to generate
a new Personal access token. You might need to re-enter your password. Just select <code>repo</code>, or
if your repository is public, you can select <code>public_repo</code> instead. GitHub will create the token and
give you a chance to copy it down.</p></li>
<li><p>Travis will need to <a href="http://docs.travis-ci.com/user/encryption-keys/">encrypt</a> this token. The short story is:</p>

<pre><code># Install Ruby first. Will probably require sudo
gem install travis
</code></pre>

<p>If <code>sudo</code> isn&#39;t available, you can do a local install</p>

<pre><code># Look at ~/.gem/
gem install --user-install travis
</code></pre></li>
<li><p><code>cd</code> to the R package directory, and run</p>

<pre><code>travis encrypt GH_TOKEN=$MY_ACCESS_TOKEN --add env.global
</code></pre>

<p>where <code>$MY_ACCESS_TOKEN</code> is your access token. The <code>--add env.global</code> automatically adds the token to your <code>.travis.yml</code> file</p></li>
<li><p>Copy across <code>deploy.sh</code> and edit appropriately.</p></li>
<li><p>Add the line</p>

<pre><code>after_success:
- test $TRAVIS_PULL_REQUEST == &quot;false&quot; &amp;&amp; test $TRAVIS_BRANCH == &quot;master&quot; &amp;&amp; bash deploy.sh
</code></pre>

<p>to your <code>.travis.yml</code> file. This means your <code>drat</code> repository is only updated:</p>

<ul>
<li>for successful builds</li>
<li>only on the master branch</li>
<li>not for pull requests</li>
</ul></li>
</ol>

<h2>TODO</h2>

<ol>
<li>The bash script is a bit hacky.</li>
<li>I suspect the call to <code>devtools::build</code> in <code>deploy.sh</code> isn&#39;t needed. Since travis has already built the R package, it should be around somewhere (but I couldn&#39;t find it).</li>
<li>It should be possible to only update if a version is tagged. Travis provides a variable <code>$TRAVIS_TAG</code>, that is empty if the commit isn&#39;t a tag. <strong>But</strong> when tagging, <code>$TRAVIS_BRANCH</code> also changes to the tag name.</li>
</ol>

</body>

</html>
